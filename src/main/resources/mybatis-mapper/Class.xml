<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sm.mapper.ClassMapper">

    <select id="selectClassList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        	tb1.SEQ 
        	,(SELECT USER_NM FROM MEM01MT sub  WHERE sub.USER_NO = tb1.USER_NO) AS USER_NM
        	, (SELECT USER_NM FROM MEM01MT sub WHERE sub.USER_NO = tb1.T_NO ) AS T_NM
        	,tb1.SEQ
        	,tb1.PAY_TYPE
        	,tb1.AMT
        	,tb1.AMT_RATE
        	,tb1.JOIN_TYPE
        	,tb1.CLASS_TYPE
        	,tb1.CLASS_NM
        	,tb1.CLASS_TIME
        	,tb1.ST_DATE
        	,tb1.ED_DATE
        	,tb1.JOIN_CNT
        	,tb1.COMPLE_CNT
        	,tb1.TERM
        	,tb1.INCOME
        	,tb1.ETC
        FROM  MEM02MT tb1
        WHERE 1=1
        ORDER BY tb1.ST_DATE DESC 
    </select>
    
     <select id="selectClassInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
         SELECT 
         	tb1.SEQ
        	,(SELECT USER_NM FROM MEM01MT sub  WHERE sub.USER_NO = tb1.USER_NO) AS USER_NM
        	, (SELECT USER_NM FROM MEM01MT sub WHERE sub.USER_NO = tb1.T_NO ) AS T_NM
        	,tb1.T_NO
        	,tb1.USER_NO
        	,tb1.SEQ
        	,tb1.PAY_TYPE
        	,tb1.AMT
        	,tb1.AMT_RATE
        	,tb1.JOIN_TYPE
        	,tb1.CLASS_TYPE
        	,tb1.CLASS_NM
        	,tb1.CLASS_TIME
        	,tb1.ST_DATE
        	,tb1.ED_DATE
        	,tb1.JOIN_CNT
        	,tb1.COMPLE_CNT
        	,tb1.TERM
        	,tb1.INCOME
        	,tb1.ETC
        	,tb1.REFUND_DATE
        	,tb1.REFUND_AMT
        FROM  MEM02MT tb1
        WHERE SEQ =#{seq}
    </select>
    
    
    <insert id="insertClass" parameterType="java.util.HashMap">
		INSERT INTO MEM02MT ( SEQ 
        ,USER_NO
        ,T_NO
        ,PAY_TYPE
        ,AMT
        ,AMT_RATE
        ,JOIN_TYPE
        ,CLASS_TYPE
        ,CLASS_NM
        ,CLASS_TIME
        ,ST_DATE
        ,ED_DATE
        ,JOIN_CNT
        ,COMPLE_CNT
        ,TERM
        ,INCOME
        ,ETC
        ) VALUES (
	      (SELECT IFNULL(MAX(SEQ)+1,1) FROM MEM02MT)
	      ,#{userNo}
			,#{tNo}
			,#{payType}
			,#{amt}
			,#{amtRate}
			,#{joinType}
			,#{classType}
			,#{classNm}
			,#{classTime}
			,#{stDate}
			,#{edDate}
			,#{joinCnt}
			,#{compleCnt}
			,#{term}
			,#{income}
			,#{etc}
	      
        )
       
	</insert>
	
	<update id="updateClass" parameterType="java.util.HashMap">
		UPDATE MEM02MT SET
		 USER_NO =#{userNo}
        ,T_NO =#{tNo}
        ,PAY_TYPE =#{payType}
        ,AMT =#{amt}
        ,AMT_RATE  =#{amtRate}
        ,JOIN_TYPE =#{joinType}
        ,CLASS_TYPE =#{classType}
        ,CLASS_NM =#{classNm}
        ,CLASS_TIME =#{classTime}
        ,ST_DATE =#{stDate}
        ,ED_DATE =#{edDate}
        ,JOIN_CNT =#{joinCnt}
        ,COMPLE_CNT =#{compleCnt}
        ,TERM =#{term}
        ,INCOME =#{income}
        ,ETC =#{etc}
        ,REFUND_DATE =#{refundDate}
        ,REFUND_AMT =#{refundAmt}
		WHERE SEQ = #{seq}
	
	</update>
	
	
	<select id="selectLessonDate" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT SEQ,
			CLASS_SEQ,
			CLASS_DATE,
			CLASS_TIME
		FROM MEM02DT
		WHERE CLASS_SEQ = #{classSeq}
		ORDER BY CLASS_DATE DESC, CLASS_TIME ASC
	
	</select>
	
	<insert id="insertLessonDate" parameterType="java.util.HashMap">
		INSERT INTO MEM02DT ( 
			SEQ,
			CLASS_SEQ,
			CLASS_DATE,
			CLASS_TIME
		) VALUES (
			(SELECT IFNULL(MAX(SEQ)+1,1) FROM MEM02DT)
			,#{classSeq}
			,#{classDate}
			,#{classTime}
		)
		
		
	</insert>
	
	<delete id="deleteLessonDate" parameterType="java.util.HashMap">
		DELETE FROM MEM02DT
		WHERE SEQ =#{seq}
	</delete>
	
	
	
	<select id="selectCalculateList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
        	tb1.SEQ 
        	,(SELECT USER_NM FROM MEM01MT sub  WHERE sub.USER_NO = tb1.USER_NO) AS USER_NM
        	, (SELECT USER_NM FROM MEM01MT sub WHERE sub.USER_NO = tb1.T_NO ) AS T_NM
        	,tb1.SEQ
        	,tb1.PAY_TYPE
        	,tb1.AMT
        	,tb1.AMT_RATE
        	,tb1.JOIN_TYPE
        	,tb1.CLASS_TYPE
        	,tb1.CLASS_NM
        	,tb1.CLASS_TIME
        	,tb1.ST_DATE
        	,tb1.ED_DATE
        	,tb1.JOIN_CNT
        	,tb1.COMPLE_CNT
        	,tb1.TERM
        	,tb1.INCOME
        	,tb1.ETC
        FROM  MEM02MT tb1
       	WHERE T_NO = #{tNo}
		AND ST_DATE BETWEEN  #{stDate} AND #{edDate}
		ORDER BY ST_DATE ASC , CLASS_TIME
    </select>
    
    <select id="selectCalculateSumInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
       SELECT SUM(AMT) AMT, PAY_TYPE 
		FROM MEM02MT
		WHERE T_NO = 1
		AND ST_DATE BETWEEN  #{stDate} AND #{edDate}
		GROUP BY PAY_TYPE
    </select>

</mapper>

